<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Begin Ideation Run</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* --- General & Reset --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        /* --- Layout & Container --- */
        .container {
            max-width: 700px;
            width: 100%;
            text-align: center;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* --- Typography --- */
        h1 {
            font-size: 3em;
            margin-bottom: 20px;
            font-weight: 400;
            letter-spacing: -1px;
        }
        
        h2 {
            font-size: 1.8em;
            margin-bottom: 30px;
            font-weight: 300;
        }
        
        .subtitle {
            font-size: 1.3em;
            color: #ccc;
            margin-bottom: 30px;
            font-weight: 300;
        }
        
        /* --- Forms & Inputs --- */
        .dropdown-container {
            margin-bottom: 40px;
        }
        
        .category-dropdown, .brand-select {
            width: 100%;
            padding: 20px 25px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 12px;
            color: white;
            font-size: 1.3em;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 20px;
            padding-right: 50px;
        }
        
        .category-dropdown:focus, .brand-select:focus, .paste-area:focus, .notes-area:focus {
            outline: none;
            border-color: #8350f3;
        }
        
        .brand-select {
            font-size: 1.1em;
            padding: 15px;
            margin: 20px 0;
        }
        
        .paste-label {
            font-size: 1.3em;
            margin-bottom: 20px;
            font-weight: 300;
            color: #ccc;
        }
        
        .paste-area, .notes-area {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            background: #2a2a2a;
            border: 1px solid #444;
            color: white;
            font-size: 1.1em;
            font-family: 'Inter', sans-serif;
            border-radius: 12px;
            margin-bottom: 20px;
            resize: vertical;
        }
        
        .notes-area {
            min-height: 150px;
            font-size: 1em;
            margin: 20px 0;
        }
        
        /* --- Buttons --- */
        .start-btn, .primary-btn {
            background: #8350f3;
            border: none;
            color: white;
            padding: 20px 60px;
            font-size: 1.3em;
            cursor: pointer;
            border-radius: 8px;
            width: 100%;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .start-btn:hover:not(:disabled), .primary-btn:hover {
            background: #7340e3;
        }
        
        .start-btn:disabled {
            background: #444;
            cursor: not-allowed;
        }
        
        .format-btn {
            background: transparent;
            border: 1px solid #666;
            color: white;
            padding: 8px 16px;
            font-size: 0.9em;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .format-btn:hover {
            border-color: #8350f3;
            color: #8350f3;
        }
        
        .format-btn.selected {
            background: #8350f3;
            border-color: #8350f3;
        }
        
        .nav-btn {
            background: transparent;
            border: 1px solid #666;
            color: white;
            padding: 15px 40px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }
        
        .nav-btn:hover:not(:disabled) {
            background: #2a2a2a;
            border-color: #8350f3;
        }
        
        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* --- Component Styles --- */
        .format-grid {
            display: grid;
            gap: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .format-category {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        
        .format-category h3 {
            color: #8350f3;
            font-size: 1.1em;
            margin-bottom: 15px;
        }
        
        .format-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .question-display {
            font-size: 1.4em;
            margin: 30px 0;
            padding: 30px;
            background: #2a2a2a;
            border-radius: 12px;
            border: 2px solid #8350f3;
            line-height: 1.6;
        }
        
        .item-text {
            font-size: 1.4em;
            margin: 30px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        
        .location-text {
            font-size: 1.6em;
            margin-top: 30px;
            margin-bottom: 10px;
            color: #8350f3;
        }

        .instruction-text {
            font-size: 1.1em;
            color: #ccc;
            margin-bottom: 30px;
            min-height: 2em; /* Reserve space to prevent layout shift */
        }
        
        .note-reminder {
            font-size: 1em;
            color: #999;
            margin-top: 40px;
            font-style: italic;
        }
        
        .nav-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .arrow {
            font-size: 1.5em;
        }
        
        .counter {
            color: #666;
            font-size: 0.9em;
            margin-top: 40px;
        }
        
        .phase-indicator {
            font-size: 1em;
            color: #888;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        /* --- Final Summary --- */
        .done-text {
            font-size: 2em;
            margin: 40px 0;
        }
        
        .final-summary {
            background: #2a2a2a;
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: left;
        }
        
        .summary-item {
            margin: 15px 0;
            padding: 15px 0;
            border-bottom: 1px solid #444;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            color: #8350f3;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Start Page -->
        <div class="page active" id="startPage">
            <h1>Begin Ideation Run</h1>
            <div class="subtitle">Select analysis category:</div>
            <div class="dropdown-container">
                <select class="category-dropdown" id="categorySelect">
                    <option value="keyword">Keyword</option>
                    <option value="theme">Theme</option>
                    <option value="concept">Concept</option>
                    <option value="framework">Framework</option>
                    <option value="question">Question</option>
                </select>
            </div>
            <div class="paste-label">Paste your list (one item per line):</div>
            <textarea class="paste-area" id="pasteArea" placeholder="paste items here..."></textarea>
            <button class="start-btn" id="startButton">Start <span class="arrow">‚ñ∂</span></button>
        </div>
        
        <!-- Format Selection Page -->
        <div class="page" id="formatSelectPage">
            <h2>Choose a Content Format</h2>
            <div class="question-display" id="questionDisplay1"></div>
            <div class="format-grid">
                <div class="format-category">
                    <h3>üìù Text-Based</h3>
                    <div class="format-options">
                        <button class="format-btn">Newsletter</button>
                        <button class="format-btn">Long-form Essay</button>
                        <button class="format-btn">Listicle</button>
                        <button class="format-btn">Twitter Thread</button>
                    </div>
                </div>
                <div class="format-category">
                    <h3>üé® Visual/Graphic</h3>
                    <div class="format-options">
                        <button class="format-btn">Instagram Carousel</button>
                        <button class="format-btn">Meme</button>
                        <button class="format-btn">Quote</button>
                        <button class="format-btn">Gif</button>
                    </div>
                </div>
                <div class="format-category">
                    <h3>üéôÔ∏è Audio</h3>
                    <div class="format-options">
                        <button class="format-btn">Podcast Segment</button>
                        <button class="format-btn">Audiogram</button>
                    </div>
                </div>
                <div class="format-category">
                    <h3>üé• Video</h3>
                    <div class="format-options">
                        <button class="format-btn">YouTube Livestream</button>
                        <button class="format-btn">Recorded Video Essay</button>
                        <button class="format-btn">TikTok/Reel</button>
                    </div>
                </div>
            </div>
            <button class="primary-btn" id="formatNextBtn" style="display: none;">Next: Assign Brand <span class="arrow">‚Üí</span></button>
        </div>
        
        <!-- Brand Selection Page -->
        <div class="page" id="brandSelectPage">
            <h2>Assign a Brand</h2>
            <div class="question-display" id="questionDisplay2"></div>
            <div class="item-text">Format: <span id="selectedFormatText"></span></div>
            <select class="brand-select" id="brandSelector">
                <option value="">Select a brand...</option>
                <option value="KNF">KNF</option>
                <option value="For Harriet">For Harriet</option>
                <option value="The Shallow Side">The Shallow Side</option>
                <option value="Taste of Kimberly">Taste of Kimberly</option>
                <option value="Kimberly Has Thoughts">Kimberly Has Thoughts</option>
                <option value="Making Things is Hard">Making Things is Hard</option>
            </select>
            <button class="primary-btn" id="startMiningBtn">Start Mining <span class="arrow">‚ñ∂</span></button>
        </div>
        
        <!-- Question Mining Task Page -->
        <div class="page" id="questionTaskPage">
            <div class="phase-indicator">Mining for Noun Phrases</div>
            <div class="step-text" id="qStepText"></div>
            <div class="task-text">Look for:</div>
            <div class="item-text" id="currentNounPhrase"></div>
            <div class="location-text">in your knowledge base</div>
            <div class="instruction-text">Scroll through photos, screenshots, saved memes, notes</div>
            <div class="note-reminder">Capture any thoughts or inspiration that could answer your question</div>
            <textarea class="notes-area" id="miningNotes" placeholder="Write your thoughts here..."></textarea>
            <div class="nav-section">
                <button class="nav-btn" id="qBackBtn"><span class="arrow">‚Üê</span></button>
                <button class="nav-btn" id="qNextBtn"><span class="arrow">‚Üí</span></button>
            </div>
            <div class="counter" id="qCounter"></div>
        </div>
        
        <!-- Title/Hook Page -->
        <div class="page" id="titlePage">
            <h2>Write a Working Title/Hook</h2>
            <div class="question-display" id="questionDisplay3"></div>
            <div class="paste-label">Draft a compelling headline or the first line you would say on camera:</div>
            <textarea class="paste-area" id="titleArea" placeholder="Enter your title or hook..." style="min-height: 150px;"></textarea>
            <div class="note-reminder">Your notes from mining:</div>
            <div class="final-summary" id="notesSummary"></div>
            <button class="primary-btn" id="completeMiningBtn">Complete <span class="arrow">‚úì</span></button>
        </div>
        
        <!-- Keyword/Theme/etc. Task Page -->
        <div class="page" id="taskPage">
            <div class="phase-indicator" id="phaseIndicator"></div>
            <div class="step-text" id="stepText"></div>
            <div class="task-text">Search for:</div>
            <div class="item-text" id="currentItem"></div>
            <div class="location-text" id="searchLocation"></div>
            <div class="instruction-text" id="searchInstruction"></div>
            <div class="note-reminder">Click the arrow to get a new search location</div>
            <div class="nav-section">
                <button class="nav-btn" id="backBtn"><span class="arrow">‚Üê</span></button>
                <button class="nav-btn" id="nextBtn"><span class="arrow">‚Üí</span></button>
            </div>
            <div class="counter" id="counter"></div>
        </div>
        
        <!-- Done Page -->
        <div class="page" id="donePage">
            <div class="done-text">‚úì Complete</div>
            <div class="final-summary" id="finalSummary" style="display: none;">
                <div class="summary-item">
                    <div class="summary-label">Question</div>
                    <div id="finalQuestion"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Format</div>
                    <div id="finalFormat"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Brand</div>
                    <div id="finalBrand"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Title/Hook</div>
                    <div id="finalTitle"></div>
                </div>
            </div>
            <button class="nav-btn" id="restartBtn">Start New Session</button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DATA ---
            const searchLocations = [
                { place: 'Camera Roll', instruction: 'Scroll through photos, screenshots, and saved memes.' },
                { place: 'Desktop Files', instruction: 'Browse PDFs, documents, and draft folders.' },
                { place: 'Notes App', instruction: 'Search your notes in Apple Notes, Notion, or Evernote.' },
                { place: 'Browser History', instruction: 'Review recently visited sites and bookmarked pages.' },
                { place: 'Email', instruction: 'Check unsent replies, drafts, and newsletters.' },
                { place: 'Kindle Highlights', instruction: 'Browse your book highlights and notes.' },
                { place: 'Readwise', instruction: 'Review your daily saved highlights and annotations.' },
                { place: 'Audible Clips', instruction: 'Check bookmarks and clips from audiobooks.' },
                { place: 'Goodreads', instruction: 'Browse your shelves, reviews, and reading updates.' },
                { place: 'Instagram Saved', instruction: 'Review your Saved Posts for inspiration.' },
                { place: 'Instagram Explore', instruction: 'Browse your Explore page for trends and ideas.' },
                { place: 'TikTok Favorites', instruction: 'Check your Favorites and Watch History.' },
                { place: 'TikTok FYP', instruction: 'Scroll your For You Page for 5 minutes.' },
                { place: 'Pinterest Boards', instruction: 'Browse your Pins and Boards.' },
                { place: 'X (Twitter) Bookmarks', instruction: 'Review your Bookmarks and interesting Replies.' },
                { place: 'X (Twitter) Lists', instruction: 'Check your curated lists for conversations.' },
                { place: 'Reddit', instruction: 'Check popular posts, your home feed, and search relevant subreddits.' },
                { place: 'YouTube Watch Later', instruction: 'Check your Watch Later list and recent comments.' },
                { place: 'Substack/Medium', instruction: 'Review your drafts and saved posts from other writers.' },
                { place: 'Netflix/Streaming', instruction: 'Check "My List" and your "Continue Watching" row.' },
                { place: 'Google Docs', instruction: 'Search your old project folders and abandoned drafts.' },
                { place: 'ChatGPT/Claude History', instruction: 'Review past conversations for interesting ideas.' },
                { place: 'Podcasts', instruction: 'Think about recent episodes that made you pause or take a note.' },
                { place: 'Spotify/Apple Music', instruction: 'Check playlists, liked songs, and podcast subscriptions.' },
                { place: 'Physical Notebooks', instruction: 'Flip through journals, agendas, and sticky notes.' },
                { place: 'Magazines/Newspapers', instruction: 'Scan headlines and articles for interesting angles.' },
                { place: 'Google Trends', instruction: 'Check trending topics related to your niche.' },
                { place: 'Google Scholar', instruction: 'Search academic papers and citations.' },
                { place: 'Google News', instruction: 'Browse top stories and topics you follow.' },
                { place: 'YouTube Trending', instruction: 'Browse the Trending tab and popular Shorts.' },
                { place: 'LinkedIn Feed', instruction: 'Review posts, newsletters, and comments in your industry.' },
                { place: 'Quora', instruction: 'Search for questions related to your topic.' },
                { place: 'Product Hunt', instruction: 'Look at new product launches and discussions.' },
                { place: 'Your Own Analytics', instruction: 'What are your most popular posts or videos about?' },
                { place: 'Your Comments Section', instruction: 'What questions are your followers asking you?' },
            ];

            // --- STATE MANAGEMENT ---
            const defaultState = {
                selectedCategory: 'keyword',
                userItems: [],
                currentIndex: 0,
                shuffledLocations: [],
                currentQuestion: '',
                selectedFormat: '',
                selectedBrand: '',
                nounPhrases: [],
                nounPhraseIndex: 0,
                miningNotes: {},
            };
            
            let appState = { ...defaultState };
            
            // --- DOM ELEMENTS ---
            const dom = {
                pages: document.querySelectorAll('.page'),
                categorySelect: document.getElementById('categorySelect'),
                pasteArea: document.getElementById('pasteArea'),
                startButton: document.getElementById('startButton'),
                formatGrid: document.querySelector('.format-grid'),
                formatButtons: document.querySelectorAll('.format-btn'),
                formatNextBtn: document.getElementById('formatNextBtn'),
                questionDisplay1: document.getElementById('questionDisplay1'),
                brandSelector: document.getElementById('brandSelector'),
                startMiningBtn: document.getElementById('startMiningBtn'),
                questionDisplay2: document.getElementById('questionDisplay2'),
                selectedFormatText: document.getElementById('selectedFormatText'),
                qStepText: document.getElementById('qStepText'),
                currentNounPhrase: document.getElementById('currentNounPhrase'),
                qCounter: document.getElementById('qCounter'),
                miningNotes: document.getElementById('miningNotes'),
                qBackBtn: document.getElementById('qBackBtn'),
                qNextBtn: document.getElementById('qNextBtn'),
                titleArea: document.getElementById('titleArea'),
                questionDisplay3: document.getElementById('questionDisplay3'),
                notesSummary: document.getElementById('notesSummary'),
                completeMiningBtn: document.getElementById('completeMiningBtn'),
                phaseIndicator: document.getElementById('phaseIndicator'),
                stepText: document.getElementById('stepText'),
                currentItem: document.getElementById('currentItem'),
                searchLocation: document.getElementById('searchLocation'),
                searchInstruction: document.getElementById('searchInstruction'),
                counter: document.getElementById('counter'),
                backBtn: document.getElementById('backBtn'),
                nextBtn: document.getElementById('nextBtn'),
                finalSummary: document.getElementById('finalSummary'),
                finalQuestion: document.getElementById('finalQuestion'),
                finalFormat: document.getElementById('finalFormat'),
                finalBrand: document.getElementById('finalBrand'),
                finalTitle: document.getElementById('finalTitle'),
                restartBtn: document.getElementById('restartBtn'),
            };
            
            // --- UI UPDATE FUNCTIONS ---
            
            const navigateTo = (pageId) => {
                dom.pages.forEach(page => {
                    page.classList.toggle('active', page.id === pageId);
                });
            };
            
            const updatePasteAreaPlaceholder = () => {
                const category = dom.categorySelect.value;
                dom.pasteArea.placeholder = `Paste your ${category}(s) here (one per line)...`;
            };
            
            const toggleStartButton = () => {
                dom.startButton.disabled = dom.pasteArea.value.trim().length === 0;
            };
            
            const showCurrentKeywordItem = () => {
                if (appState.currentIndex >= appState.userItems.length) {
                    navigateTo('donePage');
                    dom.finalSummary.style.display = 'none';
                    return;
                }
                
                const category = appState.selectedCategory;
                const locationIndex = appState.currentIndex % appState.shuffledLocations.length;
                const currentLocation = appState.shuffledLocations[locationIndex];
                
                dom.phaseIndicator.textContent = `${category.charAt(0).toUpperCase() + category.slice(1)} Search`;
                dom.stepText.textContent = `Step ${appState.currentIndex + 1}`;
                dom.currentItem.textContent = appState.userItems[appState.currentIndex];
                dom.counter.textContent = `${appState.currentIndex + 1} of ${appState.userItems.length}`;
                dom.backBtn.disabled = appState.currentIndex === 0;

                dom.searchLocation.textContent = `in ${currentLocation.place}`;
                dom.searchInstruction.textContent = currentLocation.instruction;
            };
            
            const showCurrentNounPhrase = () => {
                if (appState.nounPhraseIndex >= appState.nounPhrases.length) {
                    displayMiningNotes();
                    navigateTo('titlePage');
                    return;
                }
                
                const phrase = appState.nounPhrases[appState.nounPhraseIndex];
                dom.qStepText.textContent = `Step ${appState.nounPhraseIndex + 1}`;
                dom.currentNounPhrase.innerHTML = phrase;
                dom.qCounter.textContent = `${appState.nounPhraseIndex + 1} of ${appState.nounPhrases.length}`;
                dom.miningNotes.value = appState.miningNotes[phrase] || '';
                dom.qBackBtn.disabled = appState.nounPhraseIndex === 0;
            };

            const displayMiningNotes = () => {
                let notesHtml = '';
                Object.entries(appState.miningNotes).forEach(([phrase, notes]) => {
                    if (notes.trim()) {
                        notesHtml += `<div class="summary-item">
                            <div class="summary-label">${phrase}</div>
                            <div>${notes.replace(/\n/g, '<br>')}</div>
                        </div>`;
                    }
                });
                dom.notesSummary.innerHTML = notesHtml || '<div style="color: #666;">No notes captured.</div>';
            };
            
            // --- LOGIC & HELPER FUNCTIONS ---

            const shuffleArray = (array) => {
                return array.map(value => ({ value, sort: Math.random() }))
                            .sort((a, b) => a.sort - b.sort)
                            .map(({ value }) => value);
            };
            
            const extractNounPhrases = (question) => {
                const cleanQuestion = question.replace(/\?/g, '').toLowerCase();
                const phrases = new Set();
                const patterns = [
                    /\b(visual\s+luxury|collective\s+desires?|social\s+hierarch\w+)/gi,
                    /\b(black\s+wom[ae]n(?:'s)?\s+leisure|dominant\s+narratives?)/gi,
                    /\b(authentic\s+self[\s-]expression|marketable\s+persona)/gi,
                    /\b(digital\s+images?|emotional\s+econom\w+)/gi,
                    /\b(leisure\s+politics?|luxury\s+spaces?)/gi,
                    /\b(self[\s-]surveillance|intersectional\s+visibility)/gi,
                    /\b(visual\s+grammar|class\s+politics)/gi,
                    /\b(social\s+media|platform\s+capitalism)/gi,
                    /\b(privilege|exclusion|representation|identity|authenticity)/gi,
                    /\b(performance|curation|aspiration|consumption|labor)/gi,
                    /\b(race|gender|class|power|resistance)/gi,
                    /\b(luxury|leisure|wealth|access|belonging)/gi
                ];
                
                patterns.forEach(pattern => {
                    (cleanQuestion.match(pattern) || []).forEach(match => phrases.add(match.trim()));
                });
                
                const result = Array.from(phrases);
                return result.length > 0 ? result.slice(0, 8) : ['key themes', 'main concepts', 'central ideas'];
            };
            
            const restartApp = () => {
                appState = { ...defaultState };
                Object.values(dom).forEach(el => {
                    if (el.nodeName === 'TEXTAREA' || (el.nodeName === 'SELECT' && el.id !== 'categorySelect')) {
                        el.value = '';
                    }
                });
                dom.categorySelect.value = 'keyword';
                dom.formatButtons.forEach(btn => btn.classList.remove('selected'));
                dom.formatNextBtn.style.display = 'none';
                
                updatePasteAreaPlaceholder();
                toggleStartButton();
                navigateTo('startPage');
            };
            
            // --- EVENT HANDLERS ---
            
            const handleStartIdeation = () => {
                appState.selectedCategory = dom.categorySelect.value;
                const pastedText = dom.pasteArea.value.trim();
                if (!pastedText) return;
                
                appState.userItems = pastedText.split('\n').filter(item => item.trim() !== '');
                
                if (appState.selectedCategory === 'question') {
                    appState.currentQuestion = appState.userItems[0] || 'No question provided.';
                    appState.nounPhrases = extractNounPhrases(appState.currentQuestion);
                    dom.questionDisplay1.textContent = appState.currentQuestion;
                    navigateTo('formatSelectPage');
                } else {
                    appState.currentIndex = 0;
                    appState.shuffledLocations = shuffleArray(searchLocations);
                    showCurrentKeywordItem();
                    navigateTo('taskPage');
                }
            };
            
            const handleFormatSelection = (event) => {
                const selectedBtn = event.target.closest('.format-btn');
                if (!selectedBtn) return;
                
                appState.selectedFormat = selectedBtn.textContent;
                dom.formatButtons.forEach(btn => btn.classList.remove('selected'));
                selectedBtn.classList.add('selected');
                dom.formatNextBtn.style.display = 'flex';
            };
            
            const handleProceedToBrand = () => {
                if (!appState.selectedFormat) return;
                dom.questionDisplay2.textContent = appState.currentQuestion;
                dom.selectedFormatText.textContent = appState.selectedFormat;
                navigateTo('brandSelectPage');
            };
            
            const handleStartMining = () => {
                appState.selectedBrand = dom.brandSelector.value;
                if (!appState.selectedBrand) { alert('Please select a brand.'); return; }
                
                appState.nounPhraseIndex = 0;
                appState.miningNotes = {};
                dom.questionDisplay3.textContent = appState.currentQuestion;
                showCurrentNounPhrase();
                navigateTo('questionTaskPage');
            };
            
            const handleCompleteMining = () => {
                const title = dom.titleArea.value.trim();
                if (!title) { alert('Please provide a title or hook.'); return; }
                
                dom.finalQuestion.textContent = appState.currentQuestion;
                dom.finalFormat.textContent = appState.selectedFormat;
                dom.finalBrand.textContent = appState.selectedBrand;
                dom.finalTitle.textContent = title;
                dom.finalSummary.style.display = 'block';
                navigateTo('donePage');
            };
            
            // --- EVENT LISTENERS ---
            
            dom.categorySelect.addEventListener('change', updatePasteAreaPlaceholder);
            dom.pasteArea.addEventListener('input', toggleStartButton);
            dom.startButton.addEventListener('click', handleStartIdeation);
            dom.formatGrid.addEventListener('click', handleFormatSelection);
            dom.formatNextBtn.addEventListener('click', handleProceedToBrand);
            dom.startMiningBtn.addEventListener('click', handleStartMining);
            dom.completeMiningBtn.addEventListener('click', handleCompleteMining);
            
            dom.qNextBtn.addEventListener('click', () => {
                const phrase = appState.nounPhrases[appState.nounPhraseIndex];
                appState.miningNotes[phrase] = dom.miningNotes.value;
                appState.nounPhraseIndex++;
                showCurrentNounPhrase();
            });
            
            dom.qBackBtn.addEventListener('click', () => {
                if (appState.nounPhraseIndex > 0) {
                    const phrase = appState.nounPhrases[appState.nounPhraseIndex];
                    appState.miningNotes[phrase] = dom.miningNotes.value;
                    appState.nounPhraseIndex--;
                    showCurrentNounPhrase();
                }
            });
            
            dom.nextBtn.addEventListener('click', () => {
                appState.currentIndex++;
                showCurrentKeywordItem();
            });
            
            dom.backBtn.addEventListener('click', () => {
                if (appState.currentIndex > 0) {
                    appState.currentIndex--;
                    showCurrentKeywordItem();
                }
            });
            
            dom.restartBtn.addEventListener('click', restartApp);
            
            // --- INITIALIZATION ---
            
            const init = () => {
                restartApp();
            };
            
            init();
        });
    </script>
</body>
</html>
